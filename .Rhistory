#Bee analysis (species/genus)
#bring in data
bee_bowls <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/2019%20bees%20-%20Bowl_species.csv",na.strings = NULL)
summary(bee_bowls)
str(bee_bowls)
bee_ramps <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/2019%20bees%20-%20Ramp_species.csv",na.strings = NULL)
summary(bee_ramps)
str(bee_ramps)
#add trap type as a column on each data file
bee_bowls$Trap="bowl"
bee_ramps$Trap="ramp"
#combine data tables
library (plyr)
bees <- rbind.fill (bee_bowls, bee_ramps)
#add column for region (south central north)
bees$region<-ifelse(bees$Site=="WLR", "South",
ifelse(bees$Site=="WPR", "South",
ifelse(bees$Site=="SNY", "South",
ifelse(bees$Site=="DAL", "North",
ifelse(bees$Site=="BAL", "North",
ifelse(bees$Site == "CHA", "North", "Central")
)))))
str(bees)
#To obtain richness counts
bees.rowsums <- rowSums(bees[,4:29]>0)
bees$richness <- bees.rowsums
#To obtain abundance counts
bees.abun <- rowSums(bees[,4:29])
bees$abundance <- bees.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(bees[,4:29])
bees$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(bees[,4:29]))
bees$evenness <- evenness
View(bee_bowls)
#To obtain richness counts
bees.rowsums <- rowSums(bees[,5:30]>0)
bees$richness <- bees.rowsums
#To obtain abundance counts
bees.abun <- rowSums(bees[,5:30])
bees$abundance <- bees.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(bees[,4:29])
#calculate Shannon diversity
diversity <-diversity(bees[,5:30])
bees$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(bees[,5:30]))
bees$evenness <- evenness
#look at data set
summary(bees)
str(bees)
##richness linear mixed effects model
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain p values
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=bees)  #AIC = 171
summary(richmodel)
AIC(richmodel)
anova(richmodel)
rich.emm<-emmeans(richmodel,pairwise~region) #comparing region richness
rich.emm
#results: same for all
rich.cld<-multcomp::cld(rich.emm, alpha = 0.05, Letters = LETTERS)
rich.cld
rich.emm.s<-emmeans(richmodel,pairwise~Site) #comparing site richness
rich.emm.s
#check assumptions
dotchart(bees$richness, main = "richness", group = bees$region) # way to visualize outliers
with(bees, ad.test(richness)) #Anderson-darling test for normality (good for small sample sizes), low p-value means assumption is violated
##abundance linear mixed effects model
abunmodel <- lm(abundance~region + Date + Trap + (1|Site:Replicate), data=bees)  #AIC = 252
summary(abunmodel)
##abundance linear mixed effects model
abunmodel <- lmer(abundance~region + Date + Trap + (1|Site:Replicate), data=bees)  #AIC = 252
summary(abunmodel)
AIC(abunmodel)
anova(abunmodel)
abun.emm<-emmeans(abunmodel,pairwise~region) #comparing region abundance
abun.emm
#results: same for all
abun.cld<-multcomp::cld(abun.emm, alpha = 0.05, Letters = LETTERS)
abun.cld
##diversity linear mixed effects model
divmodel <- lmer(diversity~region + Date + Trap + (1|Site:Replicate),data=bees)  #AIC = 67
summary(divmodel)
AIC(divmodel)
anova(divmodel)
div.emm<-emmeans(divmodel,pairwise~region) #comparing region diversity
div.emm
#results: same for all
div.cld<-multcomp::cld(div.emm, alpha = 0.05, Letters = LETTERS)
div.cld
##evenness linear mixed effects model
evenmodel <- lmer(evenness~region + Date + Trap + (1|Site:Replicate),data=bees)  #AIC = -34
summary(evenmodel)
AIC(evenmodel)
anova(evenmodel)
even.emm<-emmeans(evenmodel,pairwise~region) #comparing region evenness
even.emm
#results: same for all
even.cld<-multcomp::cld(even.emm, alpha = 0.05, Letters = LETTERS)
even.cld
##
library (ggplot2)
richness.plot<-ggplot(bees, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
richness.plot
#site abundance by region
abundance.plot<-ggplot(bees, aes(x = factor(region, level = c("South","Central","North")), y = abundance, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position ="bottom")+
labs(title="", x="", y="Abundance")+
#theme (plot.title = element_text(hjust=0.5))+
#scale_y_continuous(trans="log10")+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
abundance.plot
#site diversity by region
diversity.plot<-ggplot(bees, aes(x = factor(region,level = c("South","Central","North")), y = diversity, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Shannon diversity")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
diversity.plot
#site evenness by region
evenness.plot<-ggplot(bees, aes(x = factor(region,level = c("South","Central","North")), y = evenness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="Sites by Region", y="Evenness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
evenness.plot
bees_boxplot_RandD <- ggarrange(richness.plot, diversity.plot,
#labels = c("A", "B"),
ncol = 1, nrow = 2,
common.legend = TRUE, legend = "bottom")
###
#mush together plots
library(ggpubr)
bees_boxplot_RandD <- ggarrange(richness.plot, diversity.plot,
#labels = c("A", "B"),
ncol = 1, nrow = 2,
common.legend = TRUE, legend = "bottom")
bees_boxplot_RandD
bowls <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Bowl_natural.csv",na.strings = NULL)
summary(bowls)
str(bowls)
ramps <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Ramp_natural.csv",na.strings = NULL)
summary(ramps)
str(ramps)
sticky <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Sticky%20card_natural.csv",na.strings = NULL)
summary(sticky)
str(sticky)
#add trap type as a column on each data file
bowls$Trap="bowl"
ramps$Trap="ramp"
sticky$Trap="sticky"
#combine data tables
library (plyr)
bowlramp <- rbind.fill (bowls, ramps)
allbugs <-rbind.fill (bowlramp, sticky)
#add column for region (south central north)
allbugs$region<-ifelse(allbugs$Site=="WLR", "South",
ifelse(allbugs$Site=="WPR", "South",
ifelse(allbugs$Site=="SNY", "South",
ifelse(allbugs$Site=="DAL", "North",
ifelse(allbugs$Site=="BAL", "North",
ifelse(allbugs$Site == "CHA", "North", "Central")
)))))
str(allbugs)
#To obtain richness counts
allbugs.rowsums <- rowSums(allbugs[,5:50]>0)
allbugs$richness <- allbugs.rowsums
#To obtain abundance counts
allbugs.abun <- rowSums(allbugs[,5:50])
allbugs$abundance <- allbugs.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(allbugs[,5:50])
allbugs$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(allbugs[,5:50]))
allbugs$evenness <- evenness
summary(allbugs)
str(allbugs) #trap and region are listed as character
allbugs$Trap <- as.factor(allbugs$Trap)
allbugs$region <- as.factor(allbugs$region)
str(allbugs) #now trap and region are listed as a factor
#models and checking assumptions
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain p values
library (multcompView) #to
if (!suppressWarnings(require(nortest))) install.packages("nortest")
citation("nortest")
if (!suppressWarnings(require(car))) install.packages("car")
citation("car")
if (!suppressWarnings(require(bbmle))) install.packages("bbmle")
citation("bbmle")
if (!suppressWarnings(require(DHARMa))) install.packages("DHARMa")
citation("DHARMa")
if (!suppressWarnings(require(ggplot2))) install.packages("ggplot2")
citation("ggplot2")
if (!suppressWarnings(require(sjPlot))) install.packages("sjPlot")
citation("sjPlot")
if (!suppressWarnings(require(jtools))) install.packages("jtools")
citation("jtools")
if (!suppressWarnings(require(interactions))) install.packages("interactions")
citation("interactions")
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 1062
summary(richmodel)
AIC(richmodel)
anova(richmodel) #region not sig
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs, family=gaussian())  #AIC = 1062
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs, family=gaussian)  #AIC = 1062
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 1062
summary(richmodel)
##diversity linear mixed effects model
divmodel <- lmer(diversity~region + Date + Trap + (1|Site:Replicate), data=allbugs, family=gaussian)  #AIC = 293
##diversity linear mixed effects model
divmodel <- glmer(diversity~region + Date + Trap + (1|Site:Replicate), data=allbugs, family=gaussian)  #AIC = 293
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 1062
summary(richmodel)
