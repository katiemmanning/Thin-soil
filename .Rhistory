com.matrix<-allbugs_pooled[c(3:48)]
#change to presence/absence
com.matrix[com.matrix > 0] <- 1
str(com.matrix)
rowSums(com.matrix)
#ordination by NMDS
NMDS<-metaMDS(com.matrix, distance="bray", k=2, autotransform=TRUE, trymax=300)
NMDS
pdf("site NMDS.pdf", height=6.5, width=15)
par(mfrow=c(1,3), mar=c(4.1, 4.8, 1.5, 8.1),xpd=TRUE)
plot(NMDS, disp='sites', type="n")
title(main="South", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#CAB2D6",kind="sd", conf=0.95, label=FALSE, show.groups = "WPR")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#E31A1C",kind="sd", conf=0.95, label=FALSE, show.groups = "SNY")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FF7F00",kind="sd", conf=0.95, label=FALSE, show.groups = "WLR")
points(NMDS, display="sites", select=which(env.matrix$Site=="WPR"), pch=17, col="#CAB2D6")
points(NMDS, display="sites", select=which(env.matrix$Site=="SNY"), pch=15, col="#E31A1C")
points(NMDS, display="sites", select=which(env.matrix$Site=="WLR"),pch=19, col="#FF7F00")
legend(-.45,-1, title=NULL, pch=c(19,17,15), col=c("#FF7F00","#CAB2D6","#E31A1C"), cex=1.55, legend=c("W ladder", "W picnic rock", "Synder hollow"))
plot(NMDS, disp='sites', type="n")
title(main="Central", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FB9A99",kind="sd", conf=0.95, label=FALSE, show.groups = "DGM")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#1F78B4",kind="sd", conf=0.95, label=FALSE, show.groups = "BFB")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FDBF6F",kind="sd", conf=0.95, label=FALSE, show.groups = "SSH")
points(NMDS, display="sites", select=which(env.matrix$Site=="SSH"),pch=19, col="#FDBF6F")
points(NMDS, display="sites", select=which(env.matrix$Site=="DGM"), pch=17, col="#FB9A99")
points(NMDS, display="sites", select=which(env.matrix$Site=="BFB"), pch=15, col="#1F78B4")
legend(-.65,-1, title=NULL, pch=c(19,17,15), col=c("#FDBF6F","#FB9A99","#1F78B4"), cex=1.55, legend=c("Slate shale hill", "Dusty Goldenrod meadow", "Bedford barren"))
plot(NMDS, disp='sites', type="n")
title(main="North", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#B2DF8A",kind="sd", conf=0.95, label=FALSE, show.groups = "CHA")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#33A02C",kind="sd", conf=0.95, label=FALSE, show.groups = "DAL")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#A6CEE3",kind="sd", conf=0.95, label=FALSE, show.groups = "BAL")
points(NMDS, display="sites", select=which(env.matrix$Site=="BAL"),pch=19, col="#A6CEE3")
points(NMDS, display="sites", select=which(env.matrix$Site=="CHA"), pch=17, col="#B2DF8A")
points(NMDS, display="sites", select=which(env.matrix$Site=="DAL"), pch=15, col="#33A02C")
legend(-.5,-1, title=NULL, pch=c(19,17,15), col=c("#A6CEE3","#B2DF8A","#33A02C"), cex=1.55, legend=c("Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
dev.off()
plot(NMDS, disp='sites', type="n")
title(main="South", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#CAB2D6",kind="sd", conf=0.95, label=FALSE, show.groups = "WPR")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#E31A1C",kind="sd", conf=0.95, label=FALSE, show.groups = "SNY")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FF7F00",kind="sd", conf=0.95, label=FALSE, show.groups = "WLR")
points(NMDS, display="sites", select=which(env.matrix$Site=="WPR"), pch=17, col="#CAB2D6")
points(NMDS, display="sites", select=which(env.matrix$Site=="SNY"), pch=15, col="#E31A1C")
points(NMDS, display="sites", select=which(env.matrix$Site=="WLR"),pch=19, col="#FF7F00")
legend(-.45,-1, title=NULL, pch=c(19,17,15), col=c("#FF7F00","#CAB2D6","#E31A1C"), cex=1.55, legend=c("W ladder", "W picnic rock", "Synder hollow"))
plot(NMDS, disp='sites', type="n")
pdf("site NMDS.pdf", height=6.5, width=15)
par(mfrow=c(1,3), mar=c(4.1, 4.8, 1.5, 8.1),xpd=TRUE)
plot(NMDS, disp='sites', type="n")
title(main="South", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#CAB2D6",kind="sd", conf=0.95, label=FALSE, show.groups = "WPR")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#E31A1C",kind="sd", conf=0.95, label=FALSE, show.groups = "SNY")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FF7F00",kind="sd", conf=0.95, label=FALSE, show.groups = "WLR")
points(NMDS, display="sites", select=which(env.matrix$Site=="WPR"), pch=17, col="#CAB2D6")
points(NMDS, display="sites", select=which(env.matrix$Site=="SNY"), pch=15, col="#E31A1C")
points(NMDS, display="sites", select=which(env.matrix$Site=="WLR"),pch=19, col="#FF7F00")
legend(-.45,-1, title=NULL, pch=c(19,17,15), col=c("#FF7F00","#CAB2D6","#E31A1C"), cex=1.55, legend=c("W ladder", "W picnic rock", "Synder hollow"))
plot(NMDS, disp='sites', type="n")
title(main="Central", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FB9A99",kind="sd", conf=0.95, label=FALSE, show.groups = "DGM")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#1F78B4",kind="sd", conf=0.95, label=FALSE, show.groups = "BFB")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#FDBF6F",kind="sd", conf=0.95, label=FALSE, show.groups = "SSH")
points(NMDS, display="sites", select=which(env.matrix$Site=="SSH"),pch=19, col="#FDBF6F")
points(NMDS, display="sites", select=which(env.matrix$Site=="DGM"), pch=17, col="#FB9A99")
points(NMDS, display="sites", select=which(env.matrix$Site=="BFB"), pch=15, col="#1F78B4")
legend(-.65,-1, title=NULL, pch=c(19,17,15), col=c("#FDBF6F","#FB9A99","#1F78B4"), cex=1.55, legend=c("Slate shale hill", "Dusty Goldenrod meadow", "Bedford barren"))
plot(NMDS, disp='sites', type="n")
title(main="North", adj = 0.01, line = -2, cex.main=2.5)
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#B2DF8A",kind="sd", conf=0.95, label=FALSE, show.groups = "CHA")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#33A02C",kind="sd", conf=0.95, label=FALSE, show.groups = "DAL")
ordiellipse(NMDS, env.matrix$Site, draw="polygon", col="#A6CEE3",kind="sd", conf=0.95, label=FALSE, show.groups = "BAL")
points(NMDS, display="sites", select=which(env.matrix$Site=="BAL"),pch=19, col="#A6CEE3")
points(NMDS, display="sites", select=which(env.matrix$Site=="CHA"), pch=17, col="#B2DF8A")
points(NMDS, display="sites", select=which(env.matrix$Site=="DAL"), pch=15, col="#33A02C")
legend(-.5,-1, title=NULL, pch=c(19,17,15), col=c("#A6CEE3","#B2DF8A","#33A02C"), cex=1.55, legend=c("Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
dev.off()
######
bowls <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Bowl_natural.csv",na.strings = NULL)
summary(bowls)
str(bowls)
ramps <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Ramp_natural.csv",na.strings = NULL)
summary(ramps)
str(ramps)
sticky <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Sticky%20card_natural.csv",na.strings = NULL)
summary(sticky)
str(sticky)
#add trap type as a column on each data file
bowls$Trap="bowl"
ramps$Trap="ramp"
sticky$Trap="sticky"
#combine data tables
library (plyr)
bowlramp <- rbind.fill (bowls, ramps)
allbugs <-rbind.fill (bowlramp, sticky)
#add column for region (south central north)
allbugs$region<-ifelse(allbugs$Site=="WLR", "South",
ifelse(allbugs$Site=="WPR", "South",
ifelse(allbugs$Site=="SNY", "South",
ifelse(allbugs$Site=="DAL", "North",
ifelse(allbugs$Site=="BAL", "North",
ifelse(allbugs$Site == "CHA", "North", "Central")
)))))
str(allbugs)
allbugs.rowsums <- rowSums(allbugs[,5:50]>0)
allbugs$richness <- allbugs.rowsums
#To obtain abundance counts
allbugs.abun <- rowSums(allbugs[,5:50])
allbugs$abundance <- allbugs.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(allbugs[,5:50])
allbugs$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(allbugs[,5:50]))
allbugs$evenness <- evenness
#look at data set
summary(allbugs)
str(allbugs) #trap and region are listed as character
allbugs$Trap <- as.factor(allbugs$Trap)
allbugs$region <- as.factor(allbugs$region)
str(allbugs) #now trap and region are listed as a factor
#models and checking assumptions
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain p values
library (multcompView) #to view letters
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 1062
##diversity linear mixed effects model
divmodel <- lmer(diversity~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 293
#site richness by region
richness.plot<-ggplot(allbugs, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
richness.plot
#######
#ggplot box plots
library (ggplot2)
#site richness by region
richness.plot<-ggplot(allbugs, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
richness.plot
#site diversity by region
diversity.plot<-ggplot(allbugs, aes(x = factor(region,level = c("South","Central","North")), y = diversity, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Shannon diversity")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
diversity.plot
allbugs_boxplot_RandD <- ggarrange(richness.plot, diversity.plot,
#labels = c("A", "B"),
ncol = 1, nrow = 2,
common.legend = TRUE, legend = "bottom")
###
#mush together plots
library(ggpubr)
allbugs_boxplot_RandD <- ggarrange(richness.plot, diversity.plot,
#labels = c("A", "B"),
ncol = 1, nrow = 2,
common.legend = TRUE, legend = "bottom")
allbugs_boxplot_RandD
pdf("allbugs_boxplot_RandD.pdf", height=8, width=8) #height and width in inches
allbugs_boxplot_RandD
dev.off()
bee_bowls <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/2019%20bees%20-%20Bowl_species.csv",na.strings = NULL)
summary(bee_bowls)
str(bee_bowls)
bee_ramps <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/2019%20bees%20-%20Ramp_species.csv",na.strings = NULL)
summary(bee_ramps)
str(bee_ramps)
#add trap type as a column on each data file
bee_bowls$Trap="bowl"
bee_ramps$Trap="ramp"
library (plyr)
bees <- rbind.fill (bee_bowls, bee_ramps)
#add column for region (south central north)
bees$region<-ifelse(bees$Site=="WLR", "South",
ifelse(bees$Site=="WPR", "South",
ifelse(bees$Site=="SNY", "South",
ifelse(bees$Site=="DAL", "North",
ifelse(bees$Site=="BAL", "North",
ifelse(bees$Site == "CHA", "North", "Central")
)))))
str(bees)
bees.rowsums <- rowSums(bees[,4:29]>0)
bees$richness <- bees.rowsums
#To obtain abundance counts
bees.abun <- rowSums(bees[,4:29])
bees$abundance <- bees.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(bees[,4:29])
bees$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(bees[,4:29]))
bees$evenness <- evenness
#look at data set
summary(bees)
str(bees)
##richness linear mixed effects model
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain
richmodel <- lm(richness~region+Date+Trap+Site, data=bees)  #AIC = 171
##diversity linear mixed effects model
divmodel <- lm(diversity~region+Date+Trap+Site,data=bees)  #AIC = 67
#site richness by region
richness.plot<-ggplot(bees, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
richness.plot
#site diversity by region
diversity.plot<-ggplot(bees, aes(x = factor(region,level = c("South","Central","North")), y = diversity, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Shannon diversity")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
diversity.plot
bees_boxplot_RandD <- ggarrange(richness.plot, diversity.plot,
#labels = c("A", "B"),
ncol = 1, nrow = 2,
common.legend = TRUE, legend = "bottom")
bees_boxplot_RandD
pdf("bees_boxplot_RandD.pdf", height=8, width=8) #height and width in inches
bees_boxplot_RandD
dev.off()
#bring in data
bowls_noemer <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Bowl_natural%20-%20no%20emergence.csv",na.strings = NULL)
summary(bowls_noemer)
str(bowls_noemer)
ramps_noemer <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Ramp_natural%20-%20no%20emergence.csv",na.strings = NULL)
summary(ramps_noemer)
str(ramps_noemer)
sticky_noemer <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Sticky%20card_natural%20-%20no%20emergence.csv",na.strings = NULL)
summary(sticky_noemer)
str(sticky_noemer)
#add trap type as a column on each data file
bowls_noemer$Trap="bowl"
ramps_noemer$Trap="ramp"
sticky_noemer$Trap="sticky"
#combine data tables
library (plyr)
bowlramp_noemer <- rbind.fill (bowls_noemer, ramps_noemer)
allbugs_noemer <-rbind.fill (bowlramp_noemer, sticky_noemer)
#add column for region (south central north)
allbugs_noemer$region<-ifelse(allbugs_noemer$Site=="WLR", "South",
ifelse(allbugs_noemer$Site=="WPR", "South",
ifelse(allbugs_noemer$Site=="SNY", "South",
ifelse(allbugs_noemer$Site=="DAL", "North",
ifelse(allbugs_noemer$Site=="BAL", "North",
ifelse(allbugs_noemer$Site == "CHA", "North", "Central")
)))))
str(allbugs_noemer)
#To obtain richness counts
allbugs.rowsums <- rowSums(allbugs_noemer[,5:50]>0)
allbugs_noemer$richness <- allbugs.rowsums
#To obtain abundance counts
allbugs.abun <- rowSums(allbugs_noemer[,5:50])
allbugs_noemer$abundance <- allbugs.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(allbugs_noemer[,5:50])
allbugs_noemer$diversity <-diversity
#look at data set
summary(allbugs_noemer)
str(allbugs_noemer) #trap and region are listed as character
allbugs_noemer$Trap <- as.factor(allbugs_noemer$Trap)
allbugs_noemer$region <- as.factor(allbugs_noemer$region)
str(allbugs_noemer) #now trap and region are listed as a factor
#models and checking assumptions
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain p values
library (multcompView) #to view letters
#richness
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs_noemer)  #AIC =
summary(richmodel)
AIC(richmodel)
anova(richmodel) #region not sig
#richness
richmodel_noemer <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs_noemer)  #AIC = 1064
summary(richmodel_noemer)
AIC(richmodel_noemer)
anova(richmodel_noemer) #region not sig
rich.emm<-emmeans(richmodel_noemer,pairwise~region) #comparing region richness
rich.emm
#abundance
abunmodel_noemer <- glmer(abundance~region + Date + Trap + (1|Site:Replicate),data=allbugs_noemer, family = negative.binomial(2)) #AIC 2501
summary(abunmodel_noemer)
AIC(abunmodel_noemer)
anova(abunmodel_noemer) #region sig
abun.emm<-emmeans(abunmodel_noemer,pairwise~region) #comparing region abundance
abun.emm
#diversity
divmodel_noemer <- lmer(diversity~region + Date + Trap + (1|Site:Replicate), data=allbugs_noemer)  #AIC = 293
summary(divmodel_noemer)
AIC(divmodel_noemer)
anova(divmodel_noemer) #region sig
div.emm<-emmeans(divmodel_noemer,pairwise~region) #comparing region diversity
div.emm
#results: same for all
div.cld<-multcomp::cld(div.emm, alpha = 0.05, Letters = LETTERS)
div.cld
div.emm<-emmeans(divmodel_noemer,pairwise~region) #comparing region diversity
div.emm
#evenness
evenmodel_noemer <- lmer(evenness~region + Date + Trap + (1|Site:Replicate), data=allbugs_noemer)  #AIC = -83
#calculate Evenness
evenness <-diversity/log(specnumber(allbugs_noemer[,5:50]))
allbugs_noemer$evenness <- evenness
#evenness
evenmodel_noemer <- lmer(evenness~region + Date + Trap + (1|Site:Replicate), data=allbugs_noemer)  #AIC = -83
summary(evenmodel_noemer)
AIC(evenmodel_noemer)
anova(evenmodel_noemer) #region sig
even.emm<-emmeans(evenmodel_noemer,pairwise~region) #comparing region evenness
even.emm
#site richness by region
richness.plot_noemer<-ggplot(allbugs_noemer, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
#box plot
library (ggplot2)
#site richness by region
richness.plot_noemer<-ggplot(allbugs_noemer, aes(x = factor(region,level = c("South","Central","North")), y = richness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
richness.plot_noemer
#site abundance by region
abundance.plot_noemer<-ggplot(allbugs_noemer, aes(x = factor(region, level = c("South","Central","North")), y = abundance, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position ="bottom")+
labs(title="", x="", y="Abundance (log10)")+
#theme (plot.title = element_text(hjust=0.5))+
scale_y_continuous(trans="log10")+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
abundance.plot_noemer
#site diversity by region
diversity.plot_noemer<-ggplot(allbugs_noemer, aes(x = factor(region,level = c("South","Central","North")), y = diversity, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Shannon diversity")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
diversity.plot_noemer
#site evenness by region
evenness.plot_noemer<-ggplot(allbugs_noemer, aes(x = factor(region,level = c("South","Central","North")), y = evenness, fill=Site))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="Sites by Region", y="Evenness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_brewer(palette="Paired",name="Sites:",
breaks=c("SNY", "WLR", "WPR", "BFB", "DGM", "SSH", "BAL", "CHA", "DAL"),
labels=c("Snyder hollow","W ladder", "W picnic rock", "Bedford barren","Dusty goldenrod meadow", "Slate shale hill", "Beaton alvar", "Cape Hurd alvar", "Davis alvar"))
evenness.plot_noemer
bowls <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Bowl_natural.csv",na.strings = NULL)
summary(bowls)
str(bowls)
ramps <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Ramp_natural.csv",na.strings = NULL)
summary(ramps)
str(ramps)
sticky <- read.csv("https://raw.githubusercontent.com/katiemmanning/Thin-soil/main/Data/Insect%20ID%202019%20-%20Sticky%20card_natural.csv",na.strings = NULL)
summary(sticky)
str(sticky)
#add trap type as a column on each data file
bowls$Trap="bowl"
ramps$Trap="ramp"
sticky$Trap="sticky"
#combine data tables
library (plyr)
bowlramp <- rbind.fill (bowls, ramps)
allbugs <-rbind.fill (bowlramp, sticky)
#add column for region (south central north)
allbugs$region<-ifelse(allbugs$Site=="WLR", "South",
ifelse(allbugs$Site=="WPR", "South",
ifelse(allbugs$Site=="SNY", "South",
ifelse(allbugs$Site=="DAL", "North",
ifelse(allbugs$Site=="BAL", "North",
ifelse(allbugs$Site == "CHA", "North", "Central")
)))))
str(allbugs)
#To obtain richness counts
allbugs.rowsums <- rowSums(allbugs[,5:50]>0)
allbugs$richness <- allbugs.rowsums
#To obtain abundance counts
allbugs.abun <- rowSums(allbugs[,5:50])
allbugs$abundance <- allbugs.abun
#load vegan
library(vegan)
#calculate Shannon diversity
diversity <-diversity(allbugs[,5:50])
allbugs$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(allbugs[,5:50]))
allbugs$evenness <- evenness
#look at data set
summary(allbugs)
str(allbugs) #trap and region are listed as character
allbugs$Trap <- as.factor(allbugs$Trap)
allbugs$region <- as.factor(allbugs$region)
str(allbugs) #now trap and region are listed as a factor
#models and checking assumptions
library (emmeans) #for pairwise comparisons
library(lme4)
library(lmerTest) #to obtain p values
library (multcompView) #to view letters
if (!suppressWarnings(require(nortest))) install.packages("nortest")
citation("nortest")
if (!suppressWarnings(require(car))) install.packages("car")
citation("car")
if (!suppressWarnings(require(bbmle))) install.packages("bbmle")
citation("bbmle")
if (!suppressWarnings(require(DHARMa))) install.packages("DHARMa")
citation("DHARMa")
if (!suppressWarnings(require(ggplot2))) install.packages("ggplot2")
citation("ggplot2")
if (!suppressWarnings(require(sjPlot))) install.packages("sjPlot")
citation("sjPlot")
if (!suppressWarnings(require(jtools))) install.packages("jtools")
citation("jtools")
if (!suppressWarnings(require(interactions))) install.packages("interactions")
citation("interactions")
##richness linear mixed effects model
richmodel <- lmer(richness~region + Date + Trap + (1|Site:Replicate), data=allbugs)  #AIC = 1062
summary(richmodel)
AIC(richmodel)
anova(richmodel) #region not sig
rich.emm<-emmeans(richmodel,pairwise~region) #comparing region richness
rich.emm
#results: South-Central are different, no difference between C-N or N-S
rich.cld<-multcomp::cld(rich.emm, alpha = 0.05, Letters = LETTERS)
rich.cld
#check assumptions
dotchart(allbugs$richness, main = "richness", group = allbugs$region) # way to visualize outliers
with(allbugs, ad.test(richness)) #Anderson-darling test for normality (good for small sample sizes), low p-value means assumption is violated
#p-value = 1.793e-06
with(allbugs, bartlett.test(richness ~ region)) #Bartlett test for homogeneity of variance, low p-value means assumption is violated
#p-value = 0.3217
plot(richmodel) # check distribution of residuals
# check normality with these figures, are there outliers at either end
qqnorm(resid(richmodel))
qqline(resid(richmodel))
plot(simulateResiduals(richmodel)) # another way to check for normailty and homogeneity of variance
#KS test: p = 0.58265
#dispersion test: p = 0.584
#outlier test: p = 0.05265
#no significant problems detected
densityPlot(rstudent(richmodel)) # check density estimate of the distribution of residuals
# check for outliers influencing the data
outlierTest(richmodel)
influenceIndexPlot(richmodel, vars = c("Cook"), id = list(n = 3))
#
##abundance linear mixed effects model
abunmodel <- glmer(abundance~region + Date + Trap + (1|Site:Replicate),data=allbugs, family = negative.binomial(2)) #AIC 2501
summary(abunmodel)
AIC(abunmodel)
anova(abunmodel) #region sig
abun.emm<-emmeans(abunmodel,pairwise~region) #comparing region abundance
abun.emm
diversity.plot_noemer
abundance.plot_noemer
